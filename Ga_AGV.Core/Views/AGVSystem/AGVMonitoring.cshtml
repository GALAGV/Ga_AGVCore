@{
    ViewBag.Title = "AGVMonitoring";
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
    ViewBag.PageTitle = "AGV系统";
    ViewBag.PageColumn = "运行监控";
}

<link href="~/Scripts/AGVSystem/jquery-ui-1.12.1.custom/jquery-ui.min.css" rel="stylesheet" />
<script src="~/Scripts/AGVSystem/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
<div>
    <style>
        .Control-li li {
            width: 24%;
            height: 50px;
            text-align: center;
            line-height: 50px;
            display: inline-block;
        }

        .dropdown-menu {
            position: absolute;
            top: 103%;
            left: 0;
            z-index: 1000;
            display: none;
            float: left;
            list-style: none;
            text-shadow: none;
            max-height: 180px;
            margin: 0px;
            font-size: 14px;
            font-family: "Segoe UI",Helvetica, Arial, sans-serif;
            border: 1px solid #ddd;
        }

        .form-control {
            display: block;
            width: 100%;
            height: 34px;
            padding: 6px 12px;
            font-size: 14px;
            line-height: 1.42857143;
            color: #555;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
    </style>

    <div class="count-panel" style="width:100%;min-width:1600px;margin:0px auto;">

        <div class="panel panel-default">
            <div class="panel-heading " id="pal-text"><span class="glyphicon glyphicon-tower" aria-hidden="true"></span>&nbsp;AGV监控</div>
            <div class="panel-body" style="overflow:hidden;display:block;">
                <div class="form-group">
                    <div style="float:left;display:block;width:30%;height:800px;border:red solid 1px;">
                        <div class="panel-body">
                            <div class="form-group">
                                <label class="control-label" for="txt_search_desc">选择AGV</label>
                                <select id="query_qrStatus" class="selectpicker show-tick form-control" data-live-search="false">
                                    <option value="1">AGV 1</option>
                                    <option value="2">AGV 2</option>
                                    <option value="3">AGV 3</option>
                                    <option value="4">AGV 4</option>
                                    <option value="5">AGV 5</option>
                                    <option value="6">AGV 6</option>
                                </select>
                            </div>
                        </div>
                        <div class="count-panel" style="width:100%;margin:0px auto;height:465px">
                            <div class="x_title">
                                <h2 style="font-size:18px;">基本信息</h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="clearfix">
                                <div style="width:100%;">
                                    <ul class="Control-li" style="display:block;height:50px;">
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">AGV编号</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;" id="agvNum">1号</li>
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">状态</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;color:#139656">在线</li>
                                    </ul>
                                    <ul class="Control-li" style="display:block;height:50px;margin-top:15px;">
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">二维码</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;width:74%;" id="qrCode">00015</li>
                                    </ul>
                                    <ul class="Control-li" style="display:block;height:50px;margin-top:15px;">
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">PBS</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;">区域6</li>
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">云台</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;">上升</li>
                                    </ul>
                                    <ul class="Control-li" style="display:block;height:50px;margin-top:15px;">
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">报警信息</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;width:74%;color:#139656">正常</li>
                                    </ul>
                                    <ul class="Control-li" style="display:block;height:50px;margin-top:15px;">
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">当前位置</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;" id="current_position">X10Y21</li>
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">当前任务</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;">运输</li>
                                    </ul>
                                    <ul class="Control-li" style="display:block;height:50px;margin-top:15px;">
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">出发地</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;" id="place_of_departure">X10Y21</li>
                                        <li style="background-color:#1ABC9C;color:white;font-size:18px;border-radius:2%">目的地</li>
                                        <li style="font-size:18px;font-weight:bold;background: #EDEDED;" id="destination">X10Y21</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div style="height:800px;width:1000px;float:left;margin-left:60px;display:block;overflow:scroll;border:#000000 solid 2px;padding:10px 15px 5px 10px;">
                        <div style="width:200px;height:20px;margin:10px 0px 10px 100px;">
                            <form id="reservation">
                                <div id='slider'></div>
                            </form>
                        </div>
                        <canvas id="canvas" style="border:red solid 1px">您当前的浏览器版本不支持此功能</canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">

    var Wid = 1000; var Hei = 800; //     cm/10
    var ar = new Array();

    $(function () {
        $("#query_qrStatus").bind('change', function () {
            ShowAgvInfo($(this).val(), ar, 1);
        })
        function ShowAgvInfo(agvNum, ar, coe) {
            $("#agvNum").text(agvNum + "号");
            $("#qrCode").text("00055146512");
            $("#current_position").text("X15Y02");
            $("#place_of_departure").text("X04Y07");
            $("#destination").text("X13Y14");
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext("2d");
            ////横线
            ctx.lineWidth = (Wid / 100);//粗细
            ctx.strokeStyle = "red";
            ctx.beginPath();
            ctx.moveTo(ar[2].qrX * coe, ar[2].qrY * coe);
            ctx.lineTo(ar[4].qrX * coe, ar[4].qrY * coe);
            ctx.stroke();
            ////纵线
            ctx.strokeStyle = "red";
            ctx.beginPath();
            ctx.moveTo(ar[4].qrX * coe, ar[4].qrY * coe);
            ctx.lineTo(ar[18].qrX * coe, ar[18].qrY * coe);
            ctx.stroke();
        }
        $.ajax({
            url: '/api/AGVSystem/ShowPlace',
            type: "post",
            contentType: 'application/json',
            success: function (data) {
                for (var i = 0; i < data.total; i++) {
                    ar.push(data.rows[i])
                }
                Show(Wid, Hei, ar, 1);
                console.log(ar);
            }
        });

        //比例尺
        var select = $("#minbeds");
        var slider = $("#slider").slider({
            min: 1,
            max: 5,
            range: "min",
            slide: function (event, ui) {
                Wid = 1000 * ui.value; Hei = 800 * ui.value;
                $('#p_text').text("X" + ui.value);
                Show(Wid, Hei, ar, ui.value);
                console.log(Wid);
            }
        });
        //比例尺

        function Show(Wid, Hei, ar, coe) {

            var canvas = document.getElementById('canvas');
            canvas.width = Wid;
            canvas.height = Hei;
            if (canvas.getContext) {
                var ctx = canvas.getContext("2d"),
                    width = canvas.width,
                    height = canvas.height;
                //点
                for (var i = 0; i < ar.length; i++) {
                    ctx.beginPath();
                    ctx.arc(ar[i].qrX * coe, ar[i].qrY * coe, (Wid / 100), 0, 2 * Math.PI, false);
                    ctx.closePath(); //关闭路径
                    if (ar[i].qrStatus == 1) {
                        ctx.fillStyle = "green";
                    } else {
                        ctx.fillStyle = "red";
                    }
                    ctx.fill();//以填充方式绘制圆
                }

            }
        }

    })
</script>